<div class="tracking-container" *ngIf="currentView === 'search'">
  <div class="search-header">
    <h1 class="title">ULD Tracking System</h1>
    <div class="search-box">
      <input
        type="text"
        [(ngModel)]="searchULD"
        placeholder="Enter ULD tracking number (e.g., AKE33366QN)"
        class="search-input"
        (keyup.enter)="trackULD()"
      />
      <button class="search-btn" (click)="trackULD()">
        <svg
          class="search-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        Track ULD
      </button>
    </div>
    <p class="quick-access">Quick Access</p>
    @if(!loader){
    <div class="sample-ulds">
      <p class="sample-title">
        Sample ULD numbers to try:
        <span class="available-count">{{ sampleULDs.length }} available</span>
      </p>
      <div class="uld-grid">
        <div
          *ngFor="let uld of sampleULDs"
          class="uld-card"
          (click)="selectSampleULD(uld)"
        >
          {{ uld }}
        </div>
      </div>
    </div>
    } @else{
    <app-loader></app-loader>
    }
  </div>
</div>

<!-- Tracking Details View -->
<div class="tracking-details" *ngIf="currentView === 'details'">
  <div class="details-header">
    <button class="back-btn" (click)="goBack()">
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
    </button>
    <div class="uld-info">
      <h2>{{ currentULD }}</h2>
      <p>{{ currentULDType }} • {{ currentLocation }}</p>
    </div>
  </div>

  @if(!loader){
  <div class="status-cards">
    <div class="status-card">
      <div class="status-icon temp-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />
        </svg>
      </div>
      <div class="status-info">
        <span class="status-label">Temp</span>
        <span class="status-value">{{ currentULDData?.ACTUAL_TEMP }}</span>
      </div>
    </div>

    <div class="status-card">
      <div class="status-icon battery-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="1" y="6" width="18" height="12" rx="2" ry="2" />
          <path d="m23 13-2-2v-2l2-2" />
        </svg>
      </div>
      <div class="status-info">
        <span class="status-label">Battery</span>
        <span class="status-value">{{ currentULDData?.BATTERY }}</span>
      </div>
    </div>

    <div class="status-card">
      <div class="status-icon signal-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M2 17h20v2H2z" />
          <path d="M6 13h12v4H6z" />
          <path d="M10 9h4v8h-4z" />
        </svg>
      </div>
      <div class="status-info">
        <span class="status-label">Signal</span>
        <span class="status-value">{{ currentULDData?.SIGNAL }}</span>
      </div>
    </div>

    <div class="status-card">
      <div class="status-icon location-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
          <circle cx="12" cy="10" r="3" />
        </svg>
      </div>
      <div class="status-info">
        <span class="status-label">Location</span>
        <span class="status-value">{{ currentULDData?.DEP }}</span>
      </div>
    </div>
  </div>
  } @else{
  <div class='my-2'>
    <app-loader></app-loader>
  </div>
  }
  <div class="map-section" [style.visibility]="loader ? 'hidden' : 'visible'">
    <div class="map-container">
      <div #mapElement class="map-element" id="map"></div>
      <div class="map-legend">
        <h4>Legend</h4>
        <div class="legend-item">
          <span class="legend-dot green"></span>
          <span>Good Status (G)</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot red"></span>
          <span>Risk Status (R)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Modal for segment details -->
  <div class="modal-overlay" *ngIf="selectedSegment" (click)="closeInfoPanel()">
    <div class="enhanced-modal" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header">
        <div class="modal-header-content">
          <div class="modal-title-section">
            <h2 class="modal-title">{{ selectedSegment.data.ULD }}</h2>
            <div class="route-info">
              <span class="route-badge">{{ selectedSegment.from }} → {{ selectedSegment.to }}</span>
              <span class="flight-info">{{ selectedSegment.data.CARRIER_CODE }}{{ selectedSegment.data.CARRIER_NUMBER }}</span>
            </div>
          </div>
          <button class="close-button" (click)="closeInfoPanel()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Status Overview Card -->
        <div class="status-overview-card" 
             [class.status-good]="selectedSegment.data.USE_IND === 'G'" 
             [class.status-risk]="selectedSegment.data.USE_IND === 'R'">
          
          <div class="status-header">
            <div class="status-indicator">
              <div class="status-icon-wrapper">
                <svg *ngIf="selectedSegment.data.USE_IND === 'G'" class="status-icon" width="28" height="28" viewBox="0 0 24 24" fill="none">
                  <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                </svg>
                <svg *ngIf="selectedSegment.data.USE_IND === 'R'" class="status-icon" width="28" height="28" viewBox="0 0 24 24" fill="none">
                  <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="status-text-group">
                <span class="status-primary-text">{{ selectedSegment.data.USE_IND === 'G' ? 'Optimal Conditions' : 'Risk Alert' }}</span>
                <span class="status-secondary-text">Temperature Monitoring Active</span>
              </div>
            </div>
            <div class="status-badge" [class.badge-good]="selectedSegment.data.USE_IND === 'G'" [class.badge-risk]="selectedSegment.data.USE_IND === 'R'">
              {{ selectedSegment.data.USE_IND === 'G' ? 'STABLE' : 'ALERT' }}
            </div>
          </div>

          <!-- Temperature Display Section -->
          <div class="temperature-section">
            <div class="temp-main-display">
              <div class="temp-current">
                <span class="temp-number">{{ selectedSegment.data.CURRENT_TEMP }}</span>
                <span class="temp-unit">°C</span>
              </div>
              <div class="temp-details" *ngIf="selectedSegment.data.CURRENT_TEMP !== selectedSegment.data.ACTUAL_TEMP">
                <div class="temp-variance">
                  <span class="variance-label">vs Target:</span>
                  <span class="variance-value" 
                        [class.variance-positive]="selectedSegment.data.CURRENT_TEMP > selectedSegment.data.ACTUAL_TEMP"
                        [class.variance-negative]="selectedSegment.data.CURRENT_TEMP < selectedSegment.data.ACTUAL_TEMP">
                    {{ selectedSegment.data.CURRENT_TEMP > selectedSegment.data.ACTUAL_TEMP ? '+' : '' }}{{ (selectedSegment.data.CURRENT_TEMP - selectedSegment.data.ACTUAL_TEMP).toFixed(1) }}°
                  </span>
                </div>
                <span class="temp-target">Target: {{ selectedSegment.data.ACTUAL_TEMP }}°C</span>
              </div>
            </div>

            <!-- Temperature Range Visualization -->
            <div class="temp-range-container">
              <div class="temp-range-bar">
                <div class="range-track"></div>
                <div class="range-progress" [style.width.%]="getTempPercentage()"></div>
                <div class="range-thumb" [style.left.%]="getTempPercentage()"></div>
              </div>
              <div class="range-labels">
                <span class="range-label-start">-20°C</span>
                <span class="range-label-target">{{ selectedSegment.data.ACTUAL_TEMP }}°C</span>
                <span class="range-label-end">40°C</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Information Grid -->
        <div class="info-grid">
          <div class="info-card">
            <div class="info-icon flight-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 22h20M3.77 10.77l2.83 2.83a2 2 0 0 0 2.83 0L12 11V4a2 2 0 1 1 4 0v7l2.57 2.57a2 2 0 0 0 2.83 0l2.83-2.83"/>
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Flight</span>
              <span class="info-value">{{ selectedSegment.data.CARRIER_CODE }}{{ selectedSegment.data.CARRIER_NUMBER }}</span>
            </div>
          </div>

          <div class="info-card">
            <div class="info-icon container-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">ULD Type</span>
              <span class="info-value">{{ selectedSegment.data.ULD_TYPE }}</span>
            </div>
          </div>

          <div class="info-card">
            <div class="info-icon date-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Departure</span>
              <span class="info-value">{{ selectedSegment.data.DEP_DATE }}</span>
            </div>
          </div>

          <div class="info-card">
            <div class="info-icon battery-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="6" width="18" height="12" rx="2" ry="2"/>
                <line x1="23" y1="13" x2="23" y2="11"/>
              </svg>
            </div>
            <div class="info-content">
              <span class="info-label">Battery Level</span>
              <span class="info-value">{{ selectedSegment.data.BATTERY }}%</span>
            </div>
          </div>
        </div>

        <!-- Alert Messages -->
        <div class="alert-section" *ngIf="selectedSegment.data.BREACH_IND === 'Y' || selectedSegment.data.CRITICAL === 'Y'">
          <div class="alert-item breach-alert" *ngIf="selectedSegment.data.BREACH_IND === 'Y'">
            <div class="alert-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                <path d="M12 9v4"/>
                <path d="M12 17h.01"/>
              </svg>
            </div>
            <span class="alert-text">Temperature breach detected during transit</span>
          </div>
          
          <div class="alert-item critical-alert" *ngIf="selectedSegment.data.CRITICAL === 'Y'">
            <div class="alert-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
              </svg>
            </div>
            <span class="alert-text">Critical status - immediate attention required</span>
          </div>
        </div>

        <!-- Additional Details -->
        <div class="additional-details">
          <div class="detail-row">
            <span class="detail-label">Movement Date:</span>
            <span class="detail-value">{{ selectedSegment.data.MOVEMENT_DATE }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Signal Strength:</span>
            <span class="detail-value">{{ selectedSegment.data.SIGNAL }}%</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="modal-actions">
          <!-- <button class="action-button secondary-button" (click)="closeInfoPanel()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Close
          </button> -->
          <!-- <button class="action-button primary-button">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            Full Report
          </button> -->
        </div>
      </div>
    </div>
  </div>
</div>